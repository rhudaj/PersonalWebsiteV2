<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>M12</title><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/></head><body><article id="3b03a411-499c-46cd-9ec7-7f0218eaf3cc" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/book-closed_purple.svg"/></div><h1 class="page-title">M12</h1><p class="page-description"></p></header><div class="page-body"><p id="954963de-0182-4d65-bbb8-4cd6b1331bf6" class=""><strong><strong><strong><strong><strong><strong><strong><strong>Workload = </strong></strong></strong></strong></strong></strong></strong></strong>Queries + Updates</p><p id="ba76a60c-4bea-4ec3-ab2d-795ccef48e76" class=""><strong><strong><strong><strong><strong><strong><strong><strong><strong>Tuning Performance</strong></strong></strong></strong></strong></strong></strong></strong></strong></p><ul id="f4084927-c621-4a5b-8035-88e0b265546b" class="bulleted-list"><li style="list-style-type:disc">response time <ul id="0a1c0c9d-df57-4b65-8340-d56f5f3d61f9" class="bulleted-list"><li style="list-style-type:circle">time to get answer (<strong>query</strong>) </li></ul></li></ul><ul id="8ae8c6b8-e1f4-4a1d-a483-95337602c566" class="bulleted-list"><li style="list-style-type:disc">throughput <ul id="88d9021d-b2c3-4262-bda2-9ccdae323023" class="bulleted-list"><li style="list-style-type:circle">transactions / second (<strong>updates</strong>) </li></ul></li></ul><p id="142ca335-326e-443e-b105-a8f965b46f33" class=""><mark class="highlight-teal"><em>→ Adjust Parameters</em></mark></p><p id="7846adad-cf94-4114-94a1-08c60a760066" class=""><mark class="highlight-teal"><em>→ improve physical design </em></mark></p><h3 id="05e6becb-4605-49b4-b57d-c3b75a3e9d9c" class=""><mark class="highlight-teal"><em>improve physical design </em></mark></h3><p id="91a55593-d98c-4425-a47c-c0f0a86e09f3" class=""><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em>recall: index </em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em><span style="border-bottom:0.05em solid"><em>materializes</em></span><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em><em> an extension (adds an RID column) as a DS, secondary index is a projection of the primary </em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></em></p><ul id="fe768a20-8971-4b2f-b9ba-3d81225ac715" class="bulleted-list"><li style="list-style-type:disc">Each relation can only have 1 primary index</li></ul><ul id="44ded076-beec-42b5-8836-40eec42c8c56" class="bulleted-list"><li style="list-style-type:disc">they are ordered by search key(s)</li></ul><ul id="b93ea068-45a6-43f4-ab76-499f56221a63" class="bulleted-list"><li style="list-style-type:disc">can have multiple search keys<ul id="37949a05-7ff0-4056-9302-bd8e0abed0ef" class="bulleted-list"><li style="list-style-type:circle">they are ordered by the order of search-keys </li></ul></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c910f663-b5f7-400c-8360-26b4445ab19e" class="code"><code class="language-SQL">--primary index
CREATE VIEW PROF_PRIMARY AS
	(SELECT * FROM PROF)
MATERIALIZED AS &lt;BTREE W&#x27; SEARCH KEY pnum&gt;</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0f1ed5e9-5663-4755-b406-8ff3c58946c8" class="code"><code class="language-SQL">-- secondar index
CREATE VIEW PROF_SECONDARY AS
	(SELECT name, rid FROM PROF_PRIMARY)
MATERIALIZED AS &lt;BTEE W&#x27; SEARCH KEY lname&gt;</code></pre><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="3d0849ba-924c-4ebe-9563-f8cdded499f9"><div style="font-size:1.5em"><span class="icon">❗</span></div><div style="width:100%"><strong>Multi-Search Keys</strong><p id="7f713707-e1b4-4d36-a617-9e3876d3fa3c" class="">can have multiple search keys</p><p id="cd37ae15-6a00-442b-a2f1-d5fb554646d3" class="">They are ordered by the order of search-keys </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="801e38d0-eb6b-446b-bca8-ba1e3337cfa0" class="code"><code class="language-SQL">-- multiple search keys (ordered by lname, than fname)
CREATE VIEW PROF_SECONDARY AS (
	SELECT lname, fname, rid FROM PROF_PRIMARY
)
MATERIALIZED AS BTREE WITH search key (lname, fname) </code></pre><ul id="b32952db-3079-43e2-9ce8-172e3bb695d2" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-teal">Good for when WHERE clause has several conditions</mark></li></ul><ul id="a85c946a-5cb4-4da7-9551-c8fc0953bd7e" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-teal">enables index only plans </mark></li></ul></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="ef80f80b-1677-4bfa-b07f-25b52e2de6d0"><div style="font-size:1.5em"><span class="icon">❗</span></div><div style="width:100%"><mark class="highlight-red"><strong>Clustered</strong></mark><p id="d6564de9-0a17-4851-b7eb-fa9e155434a2" class="">indexes whose order of the rows in the data pages corresponds to the order of the rows in the index</p><ul id="353a1e33-3dea-4240-9188-1632504bcebd" class="bulleted-list"><li style="list-style-type:disc"><em><mark class="highlight-teal"><strong>Range queries</strong></mark></em><em><mark class="highlight-teal"> benefit from clustering </mark></em></li></ul></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="6cf4c8ff-f56a-48a1-b31b-dc239637b1b8"><div style="font-size:1.5em"><span class="icon">❗</span></div><div style="width:100%"><mark class="highlight-red"><strong>Co-Clustering</strong></mark><p id="9c325af4-1696-4e7c-aa05-7adcb54ed0d7" class="">data records of 1 are nested with data records with another </p><p id="86a2cb14-4580-42ec-8974-f043f9a82dde" class="">→ <strong><strong><strong><strong><strong><strong><strong>ie: </strong></strong></strong></strong></strong></strong></strong>if a foreign-key between between indices</p><p id="fc706e61-beb9-419b-b5dd-30e6c5f5ead3" class="">→ Speeds foreign key joins, slows down individual scans </p><p id="7d950acd-ac45-47f9-b499-9a6a7a326d00" class=""><mark class="highlight-teal"><em><strong>Join queries</strong></em></mark><mark class="highlight-teal"><em> benefit the most from </em></mark><mark class="highlight-teal"><em><strong>co-clustering </strong></em></mark></p></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="a93312f7-b230-4c88-b72c-6e230c097d54"><div style="font-size:1.5em"><span class="icon">❗</span></div><div style="width:100%"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Joining Indices</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><p id="b6b696b5-6d91-40b9-8dc5-05b13de8cecd" class="">this is allowed</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9cc5b647-f571-481e-829d-9b80e29c1260" class="code"><code class="language-SQL">CREATE VIEW as (
	SELECT INDEX1_RID, INDEX2_RID
	FROM INDEX1, INDEX2
	WHERE ...
) MATERIALIZED AS ...</code></pre></div></figure><hr id="747264af-d406-4f00-8055-4d8746b518b8"/><h3 id="b4d5c04d-b836-47fd-b9c9-02a7fc78b77b" class="">Improving Logical Schema</h3><p id="a27f9586-a9a3-40c2-bba5-25621baac5be" class=""><strong><strong><strong><strong><strong><strong><strong><strong>Normal Forms </strong></strong></strong></strong></strong></strong></strong></strong><div class="indented"><p id="985382fe-4407-41a7-aa56-a3ec519d2dbf" class=""><strong><strong><strong><strong>BCNF</strong></strong></strong></strong></p><ul id="181c0b69-c2b3-4bc9-85c4-341015a07acb" class="bulleted-list"><li style="list-style-type:disc">speed up simple updates/queries <strong>(that don’t have joins) </strong></li></ul><ul id="4d5d315d-9745-4270-a55c-8d26ce2a0c65" class="bulleted-list"><li style="list-style-type:disc">slow if you need joins (no dependencies) </li></ul><p id="063776a4-f9ff-40a9-938d-7ad6befb9162" class=""><strong><strong><strong>3NF</strong></strong></strong></p><ul id="8b34e48d-cf0f-4a48-b446-aad440fccbfc" class="bulleted-list"><li style="list-style-type:disc">speeds up queries that need joins </li></ul><p id="73b0b7ac-1e2a-49a2-9ffb-6e77451713ce" class=""><strong><strong><strong><strong><strong><strong>De-normalize</strong></strong></strong></strong></strong></strong></p><ul id="0775274b-1258-4706-924a-0d895b8c6d55" class="bulleted-list"><li style="list-style-type:disc">merge back → more redundancy w’ <strong>updates</strong> </li></ul><ul id="634e1168-5671-4175-8af8-ac29a46154f5" class="bulleted-list"><li style="list-style-type:disc">less query overhead</li></ul></div></p><h3 id="4f93fc4f-b296-416d-881b-6246ef8b45f7" class="">Tuning Queries</h3><ul id="c65508b9-fc61-4f50-9874-a3fa6568e663" class="bulleted-list"><li style="list-style-type:disc">avoid sorting: <code>ORDER BY</code>, <code>GROUP BY</code>, <code>DISTINCT</code></li></ul><ul id="c3f718a5-acf8-4e53-b678-f00c91275c09" class="bulleted-list"><li style="list-style-type:disc">replace subqueries w’ joins </li></ul><p id="b44384d2-174d-425a-8bd8-de45b7ddda47" class="">
</p><p id="0ea3cae1-69b2-4f84-9950-89687a9d3704" class="">
</p><p id="63f6e046-85e2-431f-a9bb-cb60c64ed5da" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>