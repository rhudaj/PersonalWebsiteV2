<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>M2 - Processes</title><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/></head><body><article id="ff73da51-d276-49bf-95f9-907a39b6b4e5" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/document_purple.svg"/></div><h1 class="page-title">M2 - Processes</h1><p class="page-description"></p></header><div class="page-body"><h1 id="7ab6ecc5-2d5a-4d63-a4fe-24ef93115acb" class="">Process </h1><ul id="f4643ba9-9fce-455c-98c8-d9cfbb9e3948" class="bulleted-list"><li style="list-style-type:disc">Another <em>OS abstraction </em>for User Programs</li></ul><ul id="1c936a6b-a0b3-45ee-9b2f-0e595c7d144e" class="bulleted-list"><li style="list-style-type:disc"><strong>environment</strong> for a program to run<ul id="c613e3e5-b85b-43bb-9f48-fb8f5f6da4be" class="bulleted-list"><li style="list-style-type:circle">has an instance of the actual program to run</li></ul><ul id="10a4d746-53e0-4fd8-a56b-6aeeb14c0524" class="bulleted-list"><li style="list-style-type:circle">also contains the <strong>resources</strong> needed by the program</li></ul></li></ul><ul id="e134481d-f851-4c66-b706-a988a0e9caf5" class="bulleted-list"><li style="list-style-type:disc">Each process is <strong>virtualized</strong>; see’s itself as the only program running</li></ul><table id="ce65110e-bd0d-4ffb-9432-c1e41bb1bb2a" class="simple-table"><thead class="simple-table-header"><tr id="53117835-18d9-4cff-93c0-48d62e0b78b7"><th id="swBO" class="simple-table-header-color simple-table-header">Pros</th><th id="i|}B" class="simple-table-header-color simple-table-header">Cons</th></tr></thead><tbody><tr id="960bec6f-594b-4f4d-bf90-7feaca4a2284"><td id="swBO" class="">higher <strong>throughput</strong>, lower <strong>latency</strong> </td><td id="i|}B" class="">adds overhead (extra memory to manage and time to set up)</td></tr></tbody></table><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="c13c62e9-2276-4d36-b06f-2c71aebdbaa9"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">In this module, we only consider 1 core w’ multiple processes (ie: no concurrency)</div></figure><h3 id="57ad1d89-4a8d-43f3-bc24-77b3053108c8" class="">Higher T<strong>hroughput</strong></h3><p id="d1b2aea3-601a-4ffb-b3d1-b6a7968ed11f" class="">Multiple Processes <span style="border-bottom:0.05em solid">can</span> increase CPU utilization by running 1 process while the other is waiting </p><ul id="81990701-9852-41cf-ac2e-0319c29f7d0e" class="toggle"><li><details open=""><summary><mark class="highlight-purple"><strong>Example</strong></mark></summary><figure id="f2d9f17f-8d28-4a55-9c48-a0b5f9c84bea" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_15.15.27.png"><img style="width:480px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_15.15.27.png"/></a></figure></details></li></ul><h3 id="4fa26c13-5e99-4257-8a09-3647cd5154ba" class="">Lower Latency </h3><p id="a432faee-ebab-42d7-8b20-5f7f8eb5ca51" class="">Multiple processes <span style="border-bottom:0.05em solid">can</span> lower <strong>latency</strong></p><ul id="df40d3ca-b8d1-4d4f-9aab-c0e1eed3322e" class="bulleted-list"><li style="list-style-type:disc"><strong><em>latency:</em></strong><em> average time for a process to complete (from time = 0) </em></li></ul><ul id="4da18b18-b8af-4dfb-84e8-d66095324f31" class="bulleted-list"><li style="list-style-type:disc">Individual processes take longer to complete then running them 1 at a time</li></ul><ul id="e72aafc9-6ab2-4edb-8208-7bb0e7c0b14b" class="toggle"><li><details open=""><summary><mark class="highlight-purple"><strong>Example</strong></mark></summary><figure id="438913d5-96fd-490e-98e9-a61a15c3c054" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_15.15.57.png"><img style="width:432px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_15.15.57.png"/></a></figure><p id="a92aeaa9-dc27-450f-bd82-9df0105bb167" class=""><strong>Scenario 1 </strong></p><p id="1dc99c4c-391a-4af3-822a-04f6273d5a38" class=""><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>A</mi></msub><mo>=</mo><mn>80</mn></mrow><annotation encoding="application/x-tex">T_A=80</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">80</span></span></span></span></span><span>﻿</span></span></p><p id="f042142f-2f97-479a-be8e-d21147b93f76" class=""><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>B</mi></msub><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">T_B=100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span></span><span>﻿</span></span></p><p id="49d2a529-9197-469e-bc1a-e60abae90a6e" class=""><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>latency = </mtext><mfrac><mrow><mn>80</mn><mo>+</mo><mn>100</mn></mrow><mn>2</mn></mfrac><mo>=</mo><mn>90</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">\text{latency = } \frac{80+100}{2} =90s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord text"><span class="mord">latency = </span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">80</span><span class="mbin mtight">+</span><span class="mord mtight">100</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">90</span><span class="mord mathnormal">s</span></span></span></span></span><span>﻿</span></span></p><p id="f8e52037-cb4b-405a-be71-2bcfa93b9cb7" class=""><strong>If you ran </strong><strong><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span><span>﻿</span></span></strong><strong> first: </strong></p><p id="12bc7f90-5f10-4289-9c9c-5d4fb710bc34" class=""><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>A</mi></msub><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">T_A=100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span></span><span>﻿</span></span></p><p id="d40e5833-b0e1-499a-94ef-d5c5487fa8a2" class=""><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>B</mi></msub><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">T_B=20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span></span></span></span></span><span>﻿</span></span></p><p id="2f0f1f16-b5ae-4416-883c-b7639b61ec53" class=""><link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>latency = </mtext><mfrac><mrow><mn>100</mn><mo>+</mo><mn>20</mn></mrow><mn>2</mn></mfrac><mo>=</mo><mn>60</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">\text{latency = } \frac{100+20}{2}=60s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord text"><span class="mord">latency = </span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">100</span><span class="mbin mtight">+</span><span class="mord mtight">20</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">60</span><span class="mord mathnormal">s</span></span></span></span></span><span>﻿</span></span></p></details></li></ul><hr id="68ab44f2-b2ac-4892-a735-3be7128514c7"/><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="93979393-2cd1-4335-af13-47b75ab93013"><div style="font-size:1.5em"><span class="icon">❗</span></div><div style="width:100%"><strong>Parallelism</strong><p id="15972117-1263-4ea0-98da-160395777cae" class="">Implemented with adding more <strong>cores</strong></p><ul id="474e9b30-80fa-4ac3-8f4a-9507a332ed44" class="bulleted-list"><li style="list-style-type:disc"># of processes your computer can run at the <em>same time </em></li></ul></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="9c4ed334-19e1-42cc-8037-33799b86378e"><div style="font-size:1.5em"><span class="icon">❗</span></div><div style="width:100%"><strong>Concurrency</strong><p id="3a4ef8e5-75eb-41a8-9de3-e934c5aa0b0a" class=""># processes at once (per core) = more throughput, lower latency</p></div></figure><h1 id="54d2bbd1-c44b-4471-8c92-ff2670a9f2b3" class=""><mark class="highlight-red">2 Views of a  Process</mark></h1><h1 id="fcf298cd-d09a-4df3-ab69-49ab20088dd3" class=""><mark class="highlight-orange">Kernel View </mark></h1><h3 id="d099dcbc-edd0-4541-9ff1-daa2a59e3c3d" class=""><strong>Process Control Block (PCB)</strong></h3><ul id="7294e7f3-5bb2-4caf-af33-f698f4be0f4b" class="bulleted-list"><li style="list-style-type:disc">Data structure stored for each Process stored in Kernel space</li></ul><ul id="47a646d4-122a-485d-9c28-5f2f45acb78c" class="bulleted-list"><li style="list-style-type:disc">used to fully capture the <strong>context</strong> of the program</li></ul><table id="e9b83888-c43e-4601-b6bb-9e8c7a7bd66f" class="simple-table"><tbody><tr id="fcf679a0-7b09-44c9-ae03-73a83618524d"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">State </th><td id="tgo^" class="" style="width:497px">running, ready, waiting, … </td></tr><tr id="3b5fddde-618d-4e61-8c72-4b4b6ae113ac"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">PID</th><td id="tgo^" class="" style="width:497px">Unique Process ID</td></tr><tr id="04610990-5afa-46f4-aba5-bedf4b414fe0"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">User ID</th><td id="tgo^" class="" style="width:497px"><em>User</em> created the process (they have permissions)</td></tr><tr id="23f4a8fc-0227-44d2-a4be-007f50af85da"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">Program Counter</th><td id="tgo^" class="" style="width:497px">Address of next program instruction</td></tr><tr id="958d9455-ae2f-4445-adbc-6efe4564c802"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">Registers</th><td id="tgo^" class="" style="width:497px">Copy of the hardware registers where we left off</td></tr><tr id="eb4cd13e-b0bc-4ed0-a843-1c319ffcb9ba"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">Address Space </th><td id="tgo^" class="" style="width:497px">Data structure to address-map; virtual → physical<br/>- The physical location can change when we context switch<br/></td></tr><tr id="1cf48468-9d5c-4f82-9493-15eba0f6b59f"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.98863220214844px">Open Files</th><td id="tgo^" class="" style="width:497px">Open file table</td></tr></tbody></table><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="266cdbb2-f13b-4435-9ea4-35645faf35a0"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>Stack pointer </strong><ul id="66a7d38b-3c8d-4411-98ac-2fb421776331" class="bulleted-list"><li style="list-style-type:disc">A specific <em>register</em> which is especially important</li></ul><ul id="5f236647-f8e2-4f47-937f-356f9fbb6cb1" class="bulleted-list"><li style="list-style-type:disc">The stack holds local variables and return addresses for every function (important for getting the context of our program)</li></ul></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="a934668e-68f3-48ab-b7fb-dccf85819710"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>Transferring Control</strong><p id="93ecb6b7-a5a9-47cb-b691-18c863aafcb4" class=""><mark class="highlight-gray"><em>between user &amp; kernel </em></mark></p><p id="34a202e9-e554-4fd8-9fcd-d0447c2766c3" class="">A process runs in user-space (PC → user-space memory). </p><p id="d5ad9f4b-b630-4070-abf9-89bea64ab2ff" class="">After a <em>syscall</em>, execution goes to the kernel (PC →kernel-space memory).  </p></div></figure><h3 id="1c5a7488-e53c-42de-9e3c-510c8a064f31" class="">Process States</h3><figure id="a4ec3ce3-78e5-4f00-b95d-70337c2dde78" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_16.07.18.png"><img style="width:528px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_16.07.18.png"/></a><figcaption>interrupt = pre-empted</figcaption></figure><table id="5caf75ed-8090-4830-90c4-1830ddcbc01c" class="simple-table"><tbody><tr id="48d706f2-11eb-456c-bdea-19c73ca5ed44"><th id="SE^&gt;" class="simple-table-header-color simple-table-header" style="width:95px">New </th><td id="&gt;CgZ" class="" style="width:342px">Process has been created</td></tr><tr id="f5c98aa3-a53f-4b5e-9420-dfd87a5a546b"><th id="SE^&gt;" class="simple-table-header-color simple-table-header" style="width:95px">Ready</th><td id="&gt;CgZ" class="" style="width:342px">Can run, but not chosen </td></tr><tr id="290f24a6-51e2-4aa5-bf2c-30098660438c"><th id="SE^&gt;" class="simple-table-header-color simple-table-header" style="width:95px">Running</th><td id="&gt;CgZ" class="" style="width:342px">Currently executing</td></tr><tr id="8c46848c-d6dc-4a95-9931-1438d05370d5"><th id="SE^&gt;" class="simple-table-header-color simple-table-header" style="width:95px">waiting (<strong>blocked</strong>)</th><td id="&gt;CgZ" class="" style="width:342px">Needs <strong><em>async event </em></strong>to complete <em>(e.g, input, disk access) </em></td></tr><tr id="30598fa3-5b7d-49af-a4ff-f21f84ac6210"><th id="SE^&gt;" class="simple-table-header-color simple-table-header" style="width:95px">Terminated</th><td id="&gt;CgZ" class="" style="width:342px">Fully completed</td></tr></tbody></table><p id="23d15418-0f5a-4590-9390-892400556723" class=""><mark class="highlight-red"><strong>Dispatch</strong></mark></p><ul id="a3624bc0-e478-4214-abb3-97f8add3f621" class="bulleted-list"><li style="list-style-type:disc">ready → running</li></ul><p id="e19c92d6-922d-4bc5-bc6b-09f7828b743e" class=""><mark class="highlight-red"><strong>Pre-Empt</strong></mark></p><ul id="7b145916-b2f2-48fe-afb1-a91ad94f15a8" class="bulleted-list"><li style="list-style-type:disc">running → ready</li></ul><p id="f2024cb4-7a10-4aeb-8ccd-257edc8f7050" class=""><strong>Wait → Ready</strong></p><ul id="cef09b73-e64b-4836-b4d3-0d97040febd9" class="bulleted-list"><li style="list-style-type:disc">when you get what your looking for but another process is still running</li></ul><h2 id="efbb34ad-b0d2-49cd-acc9-a642f1d52b48" class="">Scheduler </h2><p id="b2730668-2620-4a4c-a62b-7b1f570de8e8" class="">Decides the order of execution of processes (i.e, which process to dispatch next). </p><h3 id="c2e213c7-1b17-472e-863c-02184dd0a6c8" class="">Implementation</h3><ul id="d0b69c38-fc7c-45dc-92d5-80636155d9b5" class="bulleted-list"><li style="list-style-type:disc">Have a <strong>queue</strong> for each state. </li></ul><ul id="ce3d6c12-c3e5-400e-889a-66550b08de84" class="bulleted-list"><li style="list-style-type:disc">When you need to dispatch a new process, take the first item from the ready-queue. The pre-empted process goes to the back of the ready-queue. <p id="da5d5a81-5357-4d5b-9e74-5a1cf15573de" class=""><strong>FIFO + Round-Robin </strong></p><ul id="a02dd7eb-032d-470a-8094-b481b9bf94ae" class="bulleted-list"><li style="list-style-type:circle">each process is given a time-quota (how long it’s allowed to run for). When it hits the time-quota, it get’s pre-empted if it’s not finished. </li></ul><ul id="9fbb2096-973a-4fe8-8211-cd5da0f9f9d5" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-red"><strong>CON: </strong></mark><mark class="highlight-red">a process might just need a few more ms, but it will be cut-off. </mark></li></ul><p id="34bf4d21-f1f9-4ea1-9378-e34773aedf2e" class=""><strong>Priority </strong></p><ul id="b3dceb1f-4a40-4873-a052-e03320f674c9" class="bulleted-list"><li style="list-style-type:circle">Assign threads a priority. Run in the order of highest priority. </li></ul><ul id="7d56bcf5-a327-4720-8c2a-6c4c1129b19d" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-red"><strong>CON: </strong></mark><mark class="highlight-red">low priority processes might be </mark><strong><mark class="highlight-red">starved</mark></strong></li></ul></li></ul><h2 id="33aa8359-8f4d-40cc-b5c7-59507a08c0df" class="">Preemption</h2><p id="fd4b7875-54ac-4be3-aa6b-332a62cc546a" class="">To pre-empt, we need the kernel to get control back. </p><p id="c18c0f49-4a7f-4829-a1fa-c9d230d8b8e7" class="">3 ways this can happen: </p><ol type="1" id="7b0170c7-b6b6-48e9-b978-c665b4980450" class="numbered-list" start="1"><li><strong>Process </strong><em><strong>transfers control </strong></em><strong>to Kernel</strong></li></ol><ul id="8941362c-304c-4c6c-8d50-87de9948e95e" class="bulleted-list"><li style="list-style-type:disc">system call, fault (puts control to kernel, which might decide not to give it back)<ul id="6102fd57-477c-4bdc-aae1-53227a874a7f" class="bulleted-list"><li style="list-style-type:circle">may put current process to sleep (e.g, read from disk) </li></ul><ul id="2e6ad3bb-3a4f-4ace-920e-345a8aa9b343" class="bulleted-list"><li style="list-style-type:circle">may make other process runnable</li></ul></li></ul><ol type="1" id="8f2cfb95-736a-4066-ab29-da29b05e62b7" class="numbered-list" start="2"><li><strong>Periodic Timer interrupt</strong></li></ol><ul id="96c3efec-c905-4f3e-8264-1c8e2518789a" class="bulleted-list"><li style="list-style-type:disc">Round-Robin schedule; running process used up time quota</li></ul><ol type="1" id="c7aff07e-ec96-46f5-aeba-4bc921531aeb" class="numbered-list" start="3"><li><strong>Device Interrupt</strong></li></ol><ul id="0eff37e2-4cf0-46cc-925e-c4a16ade96bf" class="bulleted-list"><li style="list-style-type:disc">Disk request completed </li></ul><ul id="1bab0b4d-2a25-4dd2-8085-8dffc6798708" class="bulleted-list"><li style="list-style-type:disc">previously waiting process becomes runnable </li></ul><ul id="11ba2cfb-6031-499f-bca3-29edd40ed22b" class="bulleted-list"><li style="list-style-type:disc">higher priority process wants to run </li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="c769b2fa-1ea4-4ffa-8c5c-3677a26a7514"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>Hardware Interrupt</strong><ul id="5bc74985-efd1-4279-9937-476a56340df7" class="bulleted-list"><li style="list-style-type:disc">When a user ties something, it sends a signal to CPU. But a program is running in user-space (in running state). The interrupt is like an exception; stop execution, jump to kernel’s <strong>interrupt handler</strong>. Then you determine if the process has been running for too long. </li></ul><ul id="94521ea1-5f64-4bd2-b961-258477ca5376" class="bulleted-list"><li style="list-style-type:disc"><strong>i.e, </strong>A timer device does this every <link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span><span>﻿</span></span> ms. So this jump happens ever time. So this lets the kernel determine if a process has been running for too long (ie: pre-empt the process and dispatch a new one). </li></ul></div></figure><h2 id="a31933fb-2847-41a4-87c1-1a07ded6711a" class="">Context Switch</h2><p id="8ade3837-69d1-42b1-a69b-8515805b9119" class=""><em>Changing the running process (has cost)</em></p><div id="0c1e2e47-ede6-486e-a742-58bbc9aa0dca" class="column-list"><div id="ba903ebd-7e39-4e46-ae8e-63a644fea4c7" style="width:50%" class="column"><ol type="1" id="5852a55f-4a9b-4725-be11-676c72947540" class="numbered-list" start="1"><li>Go to <strong>kernel space </strong></li></ol><ol type="1" id="8f9f138b-e9b7-4c8b-81c4-1a6f4af00b27" class="numbered-list" start="2"><li>Save the state to the <strong>PCB</strong></li></ol><ol type="1" id="c3f32804-56a3-473e-8037-f64589a66d62" class="numbered-list" start="3"><li>Decide what process to run</li></ol><ol type="1" id="e71898e1-3e90-45db-9b65-630b78e1e09e" class="numbered-list" start="4"><li>If needed, context switch to a different process</li></ol><ol type="1" id="97111014-dc04-40ad-bcba-703b3168c896" class="numbered-list" start="5"><li>Jump back into <strong>user space </strong></li></ol></div><div id="de03d0f6-ce73-4efa-bb0c-e4b32790e91b" style="width:50%" class="column"><figure id="1b284dce-e060-4761-a01f-ed54f3238af5" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_22.26.41.png"><img style="width:240px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_22.26.41.png"/></a></figure></div></div><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="7fa74831-e21c-44f9-955d-6c7f2df42dfa"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>Cache Misses</strong><p id="93eba8a0-436f-4630-9b03-c6e81a334805" class="">When you switch programs, the virtual memory mapping changes (so cache does not have what you need). So you will initially have a lot if <em>cache misses </em>when your context switches. </p></div></figure><h1 id="42d6bd0c-5cf4-4170-8284-34d9adb39265" class=""><mark class="highlight-orange">User View</mark></h1><p id="7ef35846-b02d-44ff-9bb1-041086e48d0c" class="">Each process is <strong>virtualized</strong>; has it’s own view of the computer with it’s own: </p><ul id="e537cff3-ec2d-4eee-ba49-ee2af63dfd20" class="bulleted-list"><li style="list-style-type:disc">address space<ul id="c679806c-2922-4c70-95ca-64d037ca7424" class="bulleted-list"><li style="list-style-type:circle">0x0c000 is different in <link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></li></ul><ul id="7274bde6-5076-46c3-bdb4-d8e0f253d232" class="bulleted-list"><li style="list-style-type:circle">not possible for 2 programs to access the same memory</li></ul></li></ul><ul id="925d5c92-7323-4689-ba2e-3f032813aa58" class="bulleted-list"><li style="list-style-type:disc">open files </li></ul><ul id="ca03bd78-97a1-481a-b035-96999509fd48" class="bulleted-list"><li style="list-style-type:disc">CPU (doesn’t know it’s waiting) </li></ul><p id="15452df8-5965-42dd-914f-94cf14a0594a" class="">
</p><p id="fc47bd22-ed0a-4c93-b2fe-e39a5ce0841d" class=""><strong>Virtual Address Space</strong></p><div id="b7707f3b-b194-40f9-9791-9b074a755c85" class="column-list"><div id="94633864-587c-4990-95f3-27c6a438e352" style="width:31.25%" class="column"><figure id="dbb2b914-f0e5-4df6-bd08-70f3e8a37a61" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_23.27.32.png"><img style="width:120px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_23.27.32.png"/></a></figure></div><div id="825eb195-9e1a-4741-9092-faedea89e9e8" style="width:68.75%" class="column"><table id="fd82d351-e6e5-467d-ae2e-1d72eb2ed947" class="simple-table"><tbody><tr id="0d922154-6a5c-47e9-bbeb-301ede8c5248"><th id="a;qM" class="simple-table-header-color simple-table-header" style="width:65.99999237060547px">stack</th><td id="rxue" class="">local var’s</td></tr><tr id="2ca3cec2-1b8c-459a-a68c-3e08b8c69f5f"><th id="a;qM" class="simple-table-header-color simple-table-header" style="width:65.99999237060547px">heap</th><td id="rxue" class="">dynamic var’s</td></tr><tr id="612dfc11-bfb8-49f0-9689-bf09f2dc8e59"><th id="a;qM" class="simple-table-header-color simple-table-header" style="width:65.99999237060547px">data</th><td id="rxue" class="">global var’s</td></tr><tr id="cc399c73-385e-4ea6-b35f-987c3fc49904"><th id="a;qM" class="simple-table-header-color simple-table-header" style="width:65.99999237060547px">text</th><td id="rxue" class="">program code</td></tr></tbody></table><p id="8f27502b-e110-419f-8463-673126b4de34" class="">
</p></div></div><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">System call Interface </summary><div class="indented"><p id="ea3f4ab8-cd4e-4fba-a99d-4dd895a7531f" class=""><mark class="highlight-gray"><em>Unix/Linux implementation </em></mark></p><p id="c9440218-502d-42e9-8fd1-b7fb4136da14" class=""><strong>Summary: </strong></p><div><table id="5f932d8e-92a7-4f2b-b0f7-5ee444e773f0" class="simple-table"><thead class="simple-table-header"><tr id="fe8beaf0-5018-41e8-b3a9-3d48f7000c5e"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px">Call</th><th id="z~Ai" class="simple-table-header-color simple-table-header" style="width:315px">?</th><th id="q;ak" class="simple-table-header-color simple-table-header" style="width:244.1796875px">Returns </th></tr></thead><tbody><tr id="7a3e58b6-65e7-4a36-ba1d-204b1c70652b"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><mark class="highlight-default"><code><strong>int fork(void)</strong></code></mark></th><td id="z~Ai" class="" style="width:315px"><em>copy</em> curent process into a new addres space (diff PID)</td><td id="q;ak" class="" style="width:244.1796875px">PID of new process → parent<br/>0 → child<br/></td></tr><tr id="f485ae6a-7473-4a82-af71-4e3e6c0b3543"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><mark class="highlight-default"><code><strong>int waitpid(int pid, int *stat)</strong></code></mark></th><td id="z~Ai" class="" style="width:315px">Called by <span style="border-bottom:0.05em solid"><em>parent</em></span>, waits on <span style="border-bottom:0.05em solid"><em>child</em></span><em> </em><mark class="highlight-default"><code>pid</code></mark><em> </em>to<em> exit</em></td><td id="q;ak" class="" style="width:244.1796875px"><mark class="highlight-default"><code>pid</code></mark><mark class="highlight-default"> → success</mark><br/>-1 → error<br/></td></tr><tr id="78b86d58-44b0-4ddb-8d05-7cd67926c669"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><code><mark class="highlight-default"><strong>void exit(int status)</strong></mark></code></th><td id="z~Ai" class="" style="width:315px">Called process to explicitly <em>terminate </em><span style="border-bottom:0.05em solid">itself</span></td><td id="q;ak" class="" style="width:244.1796875px">sends <mark class="highlight-default"><code>status</code></mark><mark class="highlight-default"> to waitpid:<br/>0 → success<br/>-1 → error<br/></mark></td></tr><tr id="3ec52cd1-cae8-49a2-87bc-5d47c2ec946e"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><strong><mark class="highlight-default"><code>int kill(int pid, int sig)</code></mark></strong></th><td id="z~Ai" class="" style="width:315px">Sends <code><mark class="highlight-default">sig</mark></code><mark class="highlight-default"> to (child | parent) process </mark><code><mark class="highlight-default">pid</mark></code></td><td id="q;ak" class="" style="width:244.1796875px"></td></tr><tr id="fc9cc607-cc72-443f-915d-67d193da2456"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><mark class="highlight-default"><code><strong>int execve(char * prog, char **argv)</strong></code></mark></th><td id="z~Ai" class="" style="width:315px">Replace the address space with the new program <mark class="highlight-default"><code>prog</code></mark>. Run main with arguments <mark class="highlight-default"><code>argv</code></mark><mark class="highlight-default">.</mark></td><td id="q;ak" class="" style="width:244.1796875px">success/error</td></tr><tr id="fee6bf27-d124-4c74-a7ac-3609c1656ca5"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><mark class="highlight-default"><code><strong>int dup2(int oldfd, int newfd)</strong></code></mark></th><td id="z~Ai" class="" style="width:315px">makes <mark class="highlight-default"><code>newfd</code></mark> exact copy of <mark class="highlight-default"><code>oldfd</code></mark><mark class="highlight-default"> (closes </mark><code><mark class="highlight-default">newfd</mark></code><mark class="highlight-default"> if it was open)</mark></td><td id="q;ak" class="" style="width:244.1796875px">success/error</td></tr><tr id="dc72d593-2f79-4cf4-8388-62573acc2552"><th id="jyfX" class="simple-table-header-color simple-table-header" style="width:297.8203125px"><strong><mark class="highlight-default"><code>int pipe(int fds[2])</code></mark></strong></th><td id="z~Ai" class="" style="width:315px">writes to <mark class="highlight-default"><code>fds[1]</code></mark> will be read on <mark class="highlight-default"><code>fds[0]</code></mark></td><td id="q;ak" class="" style="width:244.1796875px">success/error</td></tr></tbody></table></div><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Create a Process</summary><div class="indented"><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="8c819bed-1777-483c-aebe-9819ea878cf1"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>int fork(void)</strong></code></mark><hr id="e3dc100c-5063-43a5-9ae9-fb7c20df9255"/><ul id="6298f0ff-978b-4bd4-b00d-f5d5fec54ba0" class="bulleted-list"><li style="list-style-type:disc"><em>copy</em> curent process into a new one (different PID)</li></ul><ul id="e82129e7-0b6e-4d1a-bcf6-bd2b40b81ebd" class="bulleted-list"><li style="list-style-type:disc">After, you can replace the program with a new one</li></ul><hr id="41930dd9-c6a0-44d6-abe9-287622153f57"/><ul id="e0950dbe-e32e-41d0-9825-e475db5bb1bd" class="toggle"><li><details open=""><summary><strong>Returns</strong></summary><p id="f7309952-2121-400e-8ebc-9ff2016226ae" class="">PID of new process → parent</p><p id="56bc082e-76b3-4b0f-becd-957ef77eb448" class="">0 → child</p></details></li></ul><hr id="885ebea2-a3b7-4a15-b6de-2d8eb37016a1"/><ul id="78988654-f684-466a-a569-884360e087c5" class="toggle"><li><details open=""><summary><mark class="highlight-purple"><strong>Ex. 1</strong></mark></summary><figure id="bbd0eb97-298e-4b40-9a5c-87b6d8ea9f4c" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_23.43.04.png"><img style="width:688px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_23.43.04.png"/></a></figure></details></li></ul><ul id="6cfbd124-19cd-4104-a6bf-ba3b0a84b719" class="toggle"><li><details open=""><summary><mark class="highlight-purple"><strong>Ex. 2 </strong></mark></summary><figure id="5a40b53e-c4d5-45a5-b1d1-ceaa0d9e2ad4" class="image"><a href="M2%20-%20Processes/Screen_Shot_2024-02-26_at_23.43.46.png"><img style="width:1223px" src="M2%20-%20Processes/Screen_Shot_2024-02-26_at_23.43.46.png"/></a></figure></details></li></ul></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="e5b32022-6518-4295-b1e1-f017dbbd5f66"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>Why Fork? </strong><p id="0d55fe04-9b1f-43e6-a8ad-fa4a8f838c2d" class="">Most calls to <code>fork</code> are immediately followed by <code>execve</code> . So we can combine them into a single <code>spawn</code> system call. </p><p id="b6ccadc8-e564-43fb-b213-41e5eac8f753" class="">But it is still sometimes useful to simply <em>fork</em> a process. </p></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="bcd4a220-aa68-44fa-8054-d4363871b158"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>int waitpid(int pid, int *stat, int opt)</strong></code></mark><hr id="18784223-b790-4086-ba99-1681c524e94e"/><ul id="c8dd6b12-8e32-4b74-a768-fed89c32e5b1" class="bulleted-list"><li style="list-style-type:disc">Called inside a parent process</li></ul><ul id="18684105-9bee-4d7a-ba1e-e5207178ff72" class="bulleted-list"><li style="list-style-type:disc">Until the child <em>terminates</em>, the parent <em>waits </em></li></ul><hr id="bce3d334-a8a5-46de-9942-3f8481e63e57"/><ul id="a3de7edf-7b40-4e69-9431-8a227f4fe654" class="toggle"><li><details open=""><summary><strong>Params</strong></summary><p id="2db5321f-3ba0-49e4-b8b0-1b73f7fbe79f" class=""><mark class="highlight-default"><code>pid</code></mark></p><ul id="338abc10-fb07-4139-9ab9-cd794be66c35" class="bulleted-list"><li style="list-style-type:disc">child process </li></ul><ul id="7747c5d8-ed2a-4ca0-ad8c-891314678742" class="bulleted-list"><li style="list-style-type:disc">-1 for any </li></ul><p id="27ac42df-a4bc-4716-9acc-8f81d4d356e8" class=""><mark class="highlight-default"><code>stat</code></mark></p><ul id="4a43b0f6-eea8-4631-9936-f7e3705adbf5" class="bulleted-list"><li style="list-style-type:disc">for exit value / signal of child process</li></ul><p id="d596b385-c3fe-40e7-b9fe-54a6e5f4b7fc" class=""><mark class="highlight-default"><code>opt</code></mark><mark class="highlight-default"> </mark></p><ul id="f8eeb34c-1d27-4172-b1b6-fc077e065962" class="bulleted-list"><li style="list-style-type:disc">0 or <code>WHOHANG</code></li></ul></details></li></ul><ul id="3e32df2e-0b98-4437-b440-7ac9b87f13d6" class="toggle"><li><details open=""><summary><strong>Returns</strong></summary><p id="3bdaaa86-6f74-4dc8-b901-7fc3794aa1f6" class="">success → <mark class="highlight-default"><code>pid</code></mark></p><p id="18a21bf9-d171-475a-9c23-f07c709cb690" class="">error → -1</p></details></li></ul></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">End Process</summary><div class="indented"><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="482c27f8-3969-4d96-8839-f18054998078"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><code><mark class="highlight-default"><strong>void exit(int status)</strong></mark></code><hr id="3d2cea35-cb26-4ab5-b82f-c4e8ad753e07"/><ul id="3d76a00b-7265-490c-a6ec-d6f2053241c4" class="bulleted-list"><li style="list-style-type:disc">Called within a process to <em>terminate</em></li></ul><hr id="a9faf251-2088-494e-aadc-ab870a67040a"/><ul id="d26b0f9d-472d-447f-b6cc-72353286b598" class="toggle"><li><details open=""><summary><strong>Params</strong></summary><p id="d1cbd4ff-3a36-4850-85c6-f7e624a18544" class=""><mark class="highlight-default"><code>status</code></mark><div class="indented"><ul id="037cfddd-452f-4846-9271-db44e3cb5e25" class="bulleted-list"><li style="list-style-type:disc">exit code, sent to <mark class="highlight-default"><code>waitpid</code></mark> of the parent process<ul id="d8c5d7a6-3934-41ad-a811-20b97131dedc" class="bulleted-list"><li style="list-style-type:circle">0 — success, non-zero — error </li></ul></li></ul></div></p></details></li></ul></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="a3c2aa9b-fb82-41a4-9b73-3fd7921f9876"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><strong><mark class="highlight-default"><code>int kill(int pid, int sig)</code></mark></strong><hr id="b253baba-c770-46d1-9a8e-da18cb3cc79b"/><ul id="125d0638-b460-43ee-8eeb-16d459225cc2" class="bulleted-list"><li style="list-style-type:disc">sends <code>sig</code> to a process with <code>pid</code><ul id="0546605a-9b86-487d-a3a7-b61790ebe456" class="bulleted-list"><li style="list-style-type:circle"><code>SIGTERM</code> — kills the process</li></ul><ul id="5a4d5a52-df1f-43c5-8186-b77099c18160" class="bulleted-list"><li style="list-style-type:circle">If the process has a handler for this signal; gives the process ability to do some cleanup before it is killed. </li></ul></li></ul><ul id="f00d569a-b5f3-4e65-83cd-f2b150a52239" class="bulleted-list"><li style="list-style-type:disc">if child kills parent, either kills child too or it get’s adopted by another process</li></ul></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Run Program</summary><div class="indented"><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="1133880f-047e-4641-b931-052de41186ec"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>int execve(char *prog, char **argv, char **envp)</strong></code></mark><hr id="ce60700c-a471-485a-9e2d-a73d0071a447"/><ul id="528842b7-68a6-4ba5-af43-7c569b5d5abe" class="bulleted-list"><li style="list-style-type:disc">Load a program into the address space of the process and run it.</li></ul><hr id="36093c78-142b-4f76-af2f-0631f4109141"/><ul id="549da294-9ea7-4d77-94ec-41bdba6d5072" class="toggle"><li><details open=""><summary><strong>Params</strong></summary><p id="1d8dc12d-0eed-4be0-b20f-622e3ab8c81a" class=""><mark class="highlight-default"><code>prog</code></mark></p><ul id="9874c7de-9c12-445e-8b8f-243c655f952c" class="bulleted-list"><li style="list-style-type:disc">pathname of program to run </li></ul><p id="3d113439-4974-4532-89bf-0a0837c38e5c" class=""><mark class="highlight-default"><code>argv</code></mark></p><ul id="3a0b9854-ff00-4375-938e-1142fff29ffa" class="bulleted-list"><li style="list-style-type:disc">argument vector that gets passed to main()</li></ul><p id="30975aa4-1f98-47e5-a9ec-8cf845c659ee" class=""><mark class="highlight-default"><code>envp</code></mark></p><ul id="2f8b59c2-d19a-4b8a-8bbc-4d0c2b7d5f5f" class="bulleted-list"><li style="list-style-type:disc">environment variables (e.g, <em>PATH, HOME</em>)</li></ul></details></li></ul></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Manipulate File Descriptors</summary><div class="indented"><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="d9280dbe-acf9-4f5d-8df3-fc36da727c9c"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>int dup2(int oldfd, int newfd)</strong></code></mark><hr id="2606bf86-c635-464c-8281-b079d38d14e5"/><ul id="74e3ba5a-4f85-469d-b6e8-a305bd50016c" class="bulleted-list"><li style="list-style-type:disc">closes <mark class="highlight-default"><code>newfd</code></mark> if it was a valid descriptor</li></ul><ul id="b0cf4439-27c2-47f2-9591-ad0a2b120176" class="bulleted-list"><li style="list-style-type:disc">makes <mark class="highlight-default"><code>newfd</code></mark> exact copy of <mark class="highlight-default"><code>oldfd</code></mark><ul id="0565d3b2-65cd-4b23-bbc0-c2ba93e4a004" class="bulleted-list"><li style="list-style-type:circle">it will get the same <em>offset </em>as <mark class="highlight-default"><code>oldfd</code></mark><mark class="highlight-default">; read/write to the same place</mark></li></ul></li></ul><hr id="3b033d74-42e5-44d1-8fe4-fad7e6df8a71"/><ul id="75ee6efa-a374-4e82-bdac-2b03d11d61ac" class="toggle"><li><details open=""><summary><strong>Ex. redirecting stdout</strong></summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1d6b6344-003b-4147-bd7c-a042fd8c43de" class="code"><code class="language-C">oldfd &lt;- fd of stdout
newfd &lt;- some file we wish to write to
dup2(oldfd, newfd); </code></pre><ul id="3bcbf194-b64d-405f-8d98-dbfce4141dbc" class="bulleted-list"><li style="list-style-type:disc">stdout operations now send the data to a file  </li></ul></details></li></ul></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="0fe8a2a7-4cd5-4bb4-aacb-f91a79d0dc3d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>File Descriptor</strong><ul id="5fdf1c1c-1286-4aa3-a1fa-b6cc0bed3622" class="bulleted-list"><li style="list-style-type:disc">Unique references to a file <strong><em>when it is open</em></strong></li></ul><ul id="bcaf078d-dc9b-4243-899b-fcc9ae89f98a" class="bulleted-list"><li style="list-style-type:disc">So that we can keep track of it and manipulate it </li></ul><ul id="bea84d23-27e7-4c30-a3b4-a0d6047757f5" class="bulleted-list"><li style="list-style-type:disc">The best-known file descriptors are<strong> stdin, stdout, stderr</strong>. </li></ul><hr id="815ad37a-a4b4-40c8-966e-d7889c1cd345"/><p id="b9497f43-e6e3-4178-8bb7-7df72dfef07d" class=""><strong>C: </strong></p><ul id="ae28a27b-e17c-4a2a-a8d5-87a6a69998c4" class="bulleted-list"><li style="list-style-type:disc"><code>open()</code> function, which returns the <mark class="highlight-default"><code><em>fd</em></code></mark><em> </em>of the opened file</li></ul><ul id="79f25dcd-2bfb-4689-8309-b19d4e95d6a3" class="bulleted-list"><li style="list-style-type:disc"><code>read()</code> data from it, <code>write()</code> data to it</li></ul></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Pipes</summary><div class="indented"><p id="a4ac8003-bc07-4eeb-a8d5-bef82567c38a" class=""><strong>Problem: </strong>A parent can talk to a child is when it <em>terminates, </em>and only sends an exit code </p><p id="61a6a4d2-ebc0-4d2c-8aab-298f605940b8" class=""><strong>Solution:</strong> pipes let 2 processes share data between each other. </p><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="b19b3423-e840-4925-a025-352c1ac02b88"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code>int pipe(int fds[2])</code></mark><hr id="d95fcdd3-90f5-479a-8b14-bbf787dc0e34"/><ul id="dd769cfc-b5f3-4a97-b47e-3bbf6bb480a9" class="bulleted-list"><li style="list-style-type:disc">gives back 2 <em>fd</em>’s </li></ul><ul id="c60a1225-6b8d-45f8-8a44-d6ced1d45905" class="bulleted-list"><li style="list-style-type:disc">writes to fds[1] will be read on fds[0]</li></ul><ul id="36e76bd6-2a91-4094-b4d2-bf11cf8b61c1" class="bulleted-list"><li style="list-style-type:disc">when last <em>copy</em> of fds[1] is closed, fds[0] will return <em>EOF</em></li></ul><ul id="6d690736-bb35-46c0-b4fa-dc3cf62f95b1" class="bulleted-list"><li style="list-style-type:disc"><strong>returns</strong> status (0 or -1)</li></ul><hr id="94467d5d-9a3d-413e-83b5-b4d23513b8c8"/><p id="5d104fb6-d6ab-4b6e-b9fc-040f4e062d4b" class=""><strong>Rules</strong></p><ol type="1" id="f3a0ddec-c78e-44d4-8a2a-dc01fe51ba8a" class="numbered-list" start="1"><li><em>read-end</em> is blocked if empty</li></ol><ol type="1" id="f18d4539-460e-434c-a5b5-4e8a04ee5747" class="numbered-list" start="2"><li><em>write-end</em> must close first</li></ol><ul id="af9f2178-e45f-4e6c-83eb-3e94cb98cebc" class="bulleted-list"><li style="list-style-type:disc"><em>read-end</em> is closed <link rel="stylesheet" type="text/css" href="/course-notes/notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∧</mo></mrow><annotation encoding="application/x-tex">\land</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"></span><span class="mord">∧</span></span></span></span></span><span>﻿</span></span> <em>write-end </em>is written to ⇒ <code>SIGPIPE</code> exception is thrown, killing <em>write end</em></li></ul></div></figure></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Implemeting the Shell </summary><div class="indented"><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">shell 1 - <mark class="highlight-gray"><em>minish.c</em></mark></summary><div class="indented"><p id="8210cf83-c14f-440f-9654-c359de69d9c6" class=""><strong>Parent Process (PID = 5) </strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="50a37f20-bd63-42a1-afba-14009176f86a" class="code"><code class="language-C" style="white-space:pre-wrap;word-break:break-all">id_t pid;
char **av; // program + arguments from input

void doexec() {
	execvp(av[0], av);  //run this program
	perror(av[0]);
	exit(1);            // terminate parent
}

int main (...) {
	while(true) {
		parse_input(&amp;av, stdin); // get program from
		pid = fork()             //create copy of this process
		switch (pid) {
			case -1:           // process wasn&#x27;t created
				perror(&quot;fork&quot;);
				break;
			case 0:            // process was created
				doexec();        // run it with the arguments
			default:
				waitpid(pid, NULL, 0);  // wait until it finishes
				break;
		}
	}
}</code></pre><ul id="502628b0-de48-43a6-90f6-9de64841918b" class="toggle"><li><details open=""><summary><strong>After </strong><code><strong>fork()</strong></code></summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="211300f7-874c-4405-8138-b346907a73df" class="code"><code class="language-C" style="white-space:pre-wrap;word-break:break-all">...
	while(true) {
		parse_input(&amp;av, stdin);
		pid = fork()
		switch (pid) {
			case -1:
				perror(&quot;fork&quot;);
				break;
			case 0:
				doexec();
			default:                  // pid &gt; 0 =&gt; PARENT process
				waitpid(pid, NULL, 0);  // wait for CHILD
				break;
		}
	}
...</code></pre></details></li></ul><h3 id="210fad7a-5506-4fde-9bc6-e2cd67bf0274" class=""><strong>Child Process (PID = 6) </strong></h3><ul id="17b6e880-e284-40d4-93e7-d7aa05f7954b" class="toggle"><li><details open=""><summary><strong>After </strong><code><strong>fork()</strong></code></summary><p id="4bfbe525-c0d4-4530-9cfa-5a9b6294bb2d" class="">Copy of the parent process. Continues executing where left off. </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8d5ce580-43f0-413c-b8bf-f117ace8c4a8" class="code"><code class="language-C" style="white-space:pre-wrap;word-break:break-all">...
	while(true) {
		parse_input(&amp;av, stdin);
		pid = fork()
		switch (pid) {         //&lt;- execution starts here
			case -1:
				perror(&quot;fork&quot;);
				break;
			case 0:        // 0 -&gt; CHILD process
				doexec();    // run the process
			default:
				waitpid(pid, NULL, 0);
				break;
		}
	}
...</code></pre></details></li></ul><ul id="693468f6-2f8e-41bf-b497-05ef93d3e13c" class="toggle"><li><details open=""><summary><strong>After </strong><code><strong>doexec()</strong></code></summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="747edb92-8cbb-4385-9080-610be0e158c7" class="code"><code class="language-C">...
void doexec() {
	execvp(av[0], av);  // this runs
	perror(av[0]);      // this NEVER EXECUTES
	exit(1)
}
...</code></pre><p id="6d1663fd-109c-490b-9549-2647a5207c77" class="">the child process is replaced by the new program</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1463d378-93bc-45bd-8e4e-aca3b1b0e8ce" class="code"><code class="language-C">int main(int argc &lt;- av[0], const char *argv[] &lt;- av) {
	// &lt;-  starts here
	...
	exit(0); // terminates CHILD, wakes up waitpid
}</code></pre><p id="8e21cf00-7d00-4fe4-9011-8eff57367c0b" class="">
</p></details></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">shell 2 - <mark class="highlight-gray"><em>redirsh.c</em></mark></summary><div class="indented"><p id="1122b569-e33d-40a7-9ba9-b74e98da428e" class="">Recognizes: <code><mark class="highlight-default">command &lt; infile &gt; outfile 2&gt; errfile</mark></code><mark class="highlight-default"> </mark></p><p id="9134eff7-90ac-4525-9948-4ccb006fbdc7" class="">Before running <code><mark class="highlight-default">command</mark></code><mark class="highlight-default">, redirect the 3 output streams</mark></p><ul id="1316c48a-d922-4a35-ae42-49bec9f8b839" class="bulleted-list"><li style="list-style-type:disc">fd 0 = stdin, take it from <em>infile</em> </li></ul><ul id="e5747061-5cc0-48ba-bd9c-717dc270fba9" class="bulleted-list"><li style="list-style-type:disc">fd 1 = stdout, redirect it to <em>outfile</em></li></ul><ul id="c99326ba-f9bc-493a-a0bb-96921d1779c3" class="bulleted-list"><li style="list-style-type:disc">fd 2 = stderr, redirect it to <em>errfile</em></li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="df70aa09-1648-441c-8677-3284db80ce9c" class="code"><code class="language-C" style="white-space:pre-wrap;word-break:break-all">outfile, infile, errfile &lt;- set from main input loop

void doexec (void) {
	int fd;

	// infile
	if (infile) { /* non-NULL for &quot;command &lt; infile&quot; */
		if ((fd = open(infile, O_RDONLY)) &lt; 0) {
			perror(infile);
			exit(1);
		}
		if (fd != 0) {
			dup2(fd, 0);
			close(fd);
		}
	}

	// outfile
	if(outfile) {
		... fd &lt;- open(outfile)
		if (fd != 1) {
			dup2(fd, 1);
			close(fd);
		}
	}

  // errfile
	if(errfile) {
		... fd &lt;- open(errfile)
		if (fd != 2) {
			dup2(fd, 2);
			close(fd);
		}
	}

	// run the program, with new redirected stdin, stdout &amp; stderr
	execvp (av[0], av);
	perror (av[0]);
	exit (1);
}</code></pre></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">shell 3 - <mark class="highlight-gray"><em>pipesh.c </em></mark></summary><div class="indented"><p id="4e9f27b2-ce91-4e38-bfaa-ff0b883eba01" class="">Recognizes the command: <mark class="highlight-default"><code>cmd1 | cmd2 | cmd3 | ...</code></mark><mark class="highlight-default"> </mark></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fa18c0e2-a124-4788-9744-65ab9743fdcc" class="code"><code class="language-C">
void doexec (void) {
	while (outcmd) {
		int pipefds[2]; pipe(pipefds);   // pipefds[0] = read-end, pipefds[1] = write-end
		pid = fork()
		switch (pid) {
			case -1:
				perror(&quot;fork&quot;);
				exit(1);
			case 0:  // CHILD process
				dup2(pipefds[1], 1);
				close(pipefds[0]); close(pipefds[1]);  //don&#x27;t need OG files
				outcmd = NULL; // stops loop
			default: // PARENT process
				dup2(pipefds[0], 0);
				close(pipefds[0]); close(pipefds[1]); //don&#x27;t need OG files
				parse_input(&amp;av, &amp;outcmd, outcmd); //
		}
	}
}</code></pre><ul id="d6c63d82-0b55-4d9d-bc4b-52db6c9fb211" class="toggle"><li><details open=""><summary><strong>child process: </strong><code><strong>fork()</strong></code><strong> </strong>returns pid = 0 </summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4533668d-6244-4bb3-954c-caaf99962ed4" class="code"><code class="language-C">void doexec (void) {
	while (outcmd) {
		...
		switch (pid) {  // pid &lt;- 0
			...
			case 0:
				// stdin for this process has already been set
				dup2(pipefds[1], 1); //stdout -&gt; write-end
				close(pipefds[0]); close(pipefds[1]);  //don&#x27;t need OG files
				outcmd = NULL; // stops loop, so that we can run the process
			...
		}
	}
}</code></pre></details></li></ul><ul id="c47c5130-c35e-41b0-aeac-fa915b80ae2e" class="toggle"><li><details open=""><summary><strong>parent process: </strong><code><strong>fork()</strong></code><strong> </strong>returns pid &gt; 0</summary><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1801e9ac-7fad-4aac-9f3c-86b38dc84d08" class="code"><code class="language-C">
void doexec (void) {
	while (outcmd) {
		int pipefds[2]; pipe(pipefds);   // pipefds[0] = read-end, pipefds[1] = write-end
		pid = fork()
		switch (pid) {
			case -1:
				...
			case 0:
				...
			default: // PARENT process
				dup2(pipefds[0], 0);
				close(pipefds[0]); close(pipefds[1]); //don&#x27;t need OG files
				parse_input(&amp;av, &amp;outcmd, outcmd)
		}
	}
}</code></pre><ul id="34a328d6-e716-4ad1-9cad-856691a33753" class="bulleted-list"><li style="list-style-type:disc">we set the <em>read-end</em> of the command to be fd[0] <ul id="6355c3da-74a7-48db-b116-04b35f515af1" class="bulleted-list"><li style="list-style-type:circle">for the first command, that would be <em>stdin</em></li></ul><ul id="9bd11401-7866-44f6-bea0-8a93cd7898d4" class="bulleted-list"><li style="list-style-type:circle">for subsequent commands, fd[0] is the fd[1] of the previous commands</li></ul></li></ul><ul id="292ba20e-1b25-4025-970f-15145585b9fc" class="bulleted-list"><li style="list-style-type:disc">We read in the subsequent command that will be piped to into <code>outcmd</code> from the original input, <code>av</code><ul id="103af06c-6750-40d4-86e3-97dabf33498f" class="bulleted-list"><li style="list-style-type:circle">as a result, the loop restarts, creating a new <em>child process </em>to the run the command</li></ul></li></ul><p id="820c56e2-9d8a-42d2-9b0c-8368f89a28c8" class="">
</p><p id="fae208ae-7d26-4c77-9c7d-27df28b57a2c" class="">
</p><p id="2164f656-91ef-415f-9b80-53fdd6deb348" class="">
</p></details></li></ul></div></details></div></details><p id="f011eb6b-244a-4d3c-987f-7afa770058f4" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"><hr/><details open="" style="padding-top:1em"><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0">Inline comments</summary><div class="indented"><div><p style="padding:0.2em"><b>Block text</b>: <mark class="highlight-yellow_background"><em>User</em></mark></p><ul class="toggle"><li><div><span class="user" style="padding:0.2em"><img src="https://lh3.googleusercontent.com/a/ALm5wu2D7opyGPhg1IC5ZBqM5ZYIOR8MwAIakj3yS20lKw=s100" class="icon user-icon"/><span><b>roman hudaj</b> <time style="font-size:0.8em">Mar 4, 2024, 11:59 AM</time></span></span></div><div style="padding:0.2em">ie: thread</div><div style="padding:0.3em"></div></li></ul></div><hr/></div><div class="indented"><div><p style="padding:0.2em"><b>Block text</b>: <mark class="highlight-yellow_background"><em>User</em></mark></p><ul class="toggle"><li><div><span class="user" style="padding:0.2em"><img src="https://lh3.googleusercontent.com/a/ALm5wu2D7opyGPhg1IC5ZBqM5ZYIOR8MwAIakj3yS20lKw=s100" class="icon user-icon"/><span><b>roman hudaj</b> <time style="font-size:0.8em">Mar 4, 2024, 11:59 AM</time></span></span></div><div style="padding:0.2em">ie: thread</div><div style="padding:0.3em"></div></li></ul></div><hr/></div></details></span></body></html>