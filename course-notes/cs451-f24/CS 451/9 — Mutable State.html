<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>9 — Mutable State</title><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/></head><body><article id="15e2e7d3-01e5-80b3-9326-c4118741b547" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/folder_purple.svg"/></div><h1 class="page-title">9 — Mutable State</h1><p class="page-description"></p></header><div class="page-body"><p id="15e2e7d3-01e5-8035-8d55-feacffa95bd9" class="">what if we wanted a <strong>distributed database</strong>?</p><ul id="15e2e7d3-01e5-806f-9e4c-c6359432c988" class="bulleted-list"><li style="list-style-type:disc">random reads/writes</li></ul><p id="15e2e7d3-01e5-801b-8e28-ffaba06762df" class="">RDBMS isnt ideal</p><ul id="15e2e7d3-01e5-808f-834c-e97c97a9570c" class="bulleted-list"><li style="list-style-type:disc">coordinating transactions =&gt; lots of back-forth communication ⇒ costly</li></ul><ul id="15e2e7d3-01e5-8077-94d4-fd7e14099b4e" class="bulleted-list"><li style="list-style-type:disc">Does not scale horizontally </li></ul><h3 id="15e2e7d3-01e5-80d7-88aa-c79ee188c297" class=""><strong>NoSQL</strong></h3><ul id="15e2e7d3-01e5-8090-9849-eb7ca69d8cd6" class="bulleted-list"><li style="list-style-type:disc">“not only sql” </li></ul><ul id="15e2e7d3-01e5-80e2-a502-de84c3097229" class="bulleted-list"><li style="list-style-type:disc">Different types of values we can store, and relationship between them (not just relational db)<ul id="15e2e7d3-01e5-8035-a581-e9743d39a7a4" class="bulleted-list"><li style="list-style-type:circle">different types (shown below) </li></ul><ul id="15e2e7d3-01e5-80cf-abfa-ee77eb013f2d" class="bulleted-list"><li style="list-style-type:circle">What they all have in common:<ul id="15e2e7d3-01e5-8044-8b19-e6b36a2cbb52" class="bulleted-list"><li style="list-style-type:square"><strong>String Keys</strong></li></ul><ul id="15e2e7d3-01e5-80eb-accd-c63b853f5c56" class="bulleted-list"><li style="list-style-type:square"><strong>Distributed / Clustered data</strong></li></ul></li></ul></li></ul><ul id="15e2e7d3-01e5-809c-9d2f-ce5d2af28840" class="bulleted-list"><li style="list-style-type:disc">features: <ul id="15e2e7d3-01e5-80d2-a132-f47623a3a53d" class="bulleted-list"><li style="list-style-type:circle">Horizontal Scaling </li></ul><ul id="15e2e7d3-01e5-802a-9fe1-ce03fc69fa51" class="bulleted-list"><li style="list-style-type:circle">Replicated and Distributed Data </li></ul><ul id="15e2e7d3-01e5-8040-88ba-d29e5430b0af" class="bulleted-list"><li style="list-style-type:circle">Weaker Concurrency (not ACID) </li></ul><ul id="15e2e7d3-01e5-80f7-8c97-f43ab86c1008" class="bulleted-list"><li style="list-style-type:circle">Flexible Schemas</li></ul></li></ul><p id="15e2e7d3-01e5-80f4-b0a8-c8de8dc01f28" class=""><strong>SQL vs. NoSQL databases: </strong></p><ul id="15e2e7d3-01e5-8011-9ba2-c5f6109097d7" class="bulleted-list"><li style="list-style-type:disc">SQL types:<ul id="15e2e7d3-01e5-80ab-a7bc-cfb188743d18" class="bulleted-list"><li style="list-style-type:circle">Relational OLTP</li></ul><ul id="15e2e7d3-01e5-8077-ab53-c9379c1bb31a" class="bulleted-list"><li style="list-style-type:circle">Analytical OLAP database</li></ul></li></ul><ul id="15e2e7d3-01e5-80ca-a527-fbf327bebd72" class="bulleted-list"><li style="list-style-type:disc">NoSQL <ul id="15e2e7d3-01e5-80b7-83f9-d7a161650521" class="bulleted-list"><li style="list-style-type:circle">Key-Value Stores <ul id="15e2e7d3-01e5-8033-ba08-c1553233556f" class="bulleted-list"><li style="list-style-type:square">Redis</li></ul></li></ul><ul id="15e2e7d3-01e5-8094-9d7f-ccb8598eb385" class="bulleted-list"><li style="list-style-type:circle">Column-Stores<ul id="15e2e7d3-01e5-80ad-b2fd-d6006747183e" class="bulleted-list"><li style="list-style-type:square">BigTable (Google), HBase (Apache)</li></ul></li></ul><ul id="15e2e7d3-01e5-8077-9d36-cdea048c73d0" class="bulleted-list"><li style="list-style-type:circle">Document-Based<ul id="15e2e7d3-01e5-80d0-bc33-e37920f3ce10" class="bulleted-list"><li style="list-style-type:square">MongoDB</li></ul></li></ul><ul id="15e2e7d3-01e5-80be-82be-dda0e5ab9656" class="bulleted-list"><li style="list-style-type:circle">Graph Stores<ul id="15e2e7d3-01e5-8018-a570-fc87e3a3afdf" class="bulleted-list"><li style="list-style-type:square">… </li></ul></li></ul></li></ul><h3 id="15e2e7d3-01e5-809b-99f7-d860327a379f" class=""><strong>Key Problem </strong></h3><p id="15e2e7d3-01e5-8007-8bb7-d6012d84aa73" class="">In your cluster of 400 servers, we want to know <strong>which machine has the key “X”? </strong></p><p id="15e2e7d3-01e5-8023-918a-d89d29664a92" class="">Problems: </p><ul id="15e2e7d3-01e5-8014-98f5-e53b971b394a" class="bulleted-list"><li style="list-style-type:disc">The cluster is not centralized (not all in one data-center)</li></ul><ul id="15e2e7d3-01e5-80d6-b075-cd94a991835c" class="bulleted-list"><li style="list-style-type:disc">nodes leaves and join all the time (ie: machines join and leave; added to network, removed ).</li></ul><p id="15e2e7d3-01e5-802a-a693-fc5869d0c150" class="">Solutions? </p><ul id="15e2e7d3-01e5-807a-a36d-d1970f56c4aa" class="bulleted-list"><li style="list-style-type:disc">Dont want a new node to have to be introduced to the whole cluster when it joins and leaves (too expensive for many machines)</li></ul><ul id="15e2e7d3-01e5-8065-a466-c8aaf790c577" class="bulleted-list"><li style="list-style-type:disc">… </li></ul><h3 id="15e2e7d3-01e5-800f-a867-d373b05c8b0b" class="">Consistent Hashing </h3><p id="15e2e7d3-01e5-8046-bfc5-f7fc713ea1e0" class=""><em><mark class="highlight-gray"><strong>DHT – Distributed Hash Table</strong></mark></em></p><ul id="15e2e7d3-01e5-80a5-a60d-dc3e1c95cd58" class="bulleted-list"><li style="list-style-type:disc">Each peer is assigned an <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span><span>﻿</span></span>-bit hash GUID<ul id="15e2e7d3-01e5-80e4-b291-fbf9741f581e" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-gray">using some hash function, </mark><mark class="highlight-gray"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span></span><span>﻿</span></span></mark></li></ul><ul id="15e2e7d3-01e5-8054-b595-d697e605b02d" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-gray">i.e. </mark><mark class="highlight-gray"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray"> assign </mark><mark class="highlight-gray"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray"> bit hash codes</mark></li></ul></li></ul><ul id="15e2e7d3-01e5-8004-b844-edcba1132701" class="bulleted-list"><li style="list-style-type:disc">For each key <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span><span>﻿</span></span>, its assigned to the <em><span style="border-bottom:0.05em solid">first node</span></em> in the ring with <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>u</mi><mi>i</mi><mi>d</mi><mo>&gt;</mo><mi>h</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">guid&gt;h(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">gu</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span><ul id="15e2e7d3-01e5-80fe-8697-ce4081eb24df" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-gray">“first node” = </mark><mark class="highlight-gray"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>c</mi><mi>c</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>r</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">successor(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">ccessor</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span></mark></li></ul></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="15e2e7d3-01e5-80cd-aca9-cc29c3ba66d3"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/exclamation-mark_gray.svg"/></div><div style="width:100%"><p id="9a3d78a0-c3bb-4c16-9e7f-db16b5553fe1" class=""><strong>“consistent”</strong></p><p id="15e2e7d3-01e5-8057-8bb9-fac49d2c7191" class=""><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span></span><span>﻿</span></span> works the same on any machine <mark class="highlight-gray">(no matter the machine they&#x27;re using, same string =&gt; same hash code). </mark></p></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="15e2e7d3-01e5-8067-9054-d5d3d16ef207"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/exclamation-mark_gray.svg"/></div><div style="width:100%"><p id="de869ec1-df94-46a8-874f-4181a4144807" class=""><strong>Why this way? </strong></p><p id="15e2e7d3-01e5-80f5-87de-d1b67858ffd4" class="">High probability that every machine will get its fair share.</p><ul id="15e2e7d3-01e5-80ff-a71f-e01fe0fdc388" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-gray">(expected) Each has </mark><mark class="highlight-gray"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi mathvariant="normal">/</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">s/m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord">/</span><span class="mord mathnormal">m</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray"> (where </mark><mark class="highlight-gray"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span></span><span>﻿</span></span></mark><mark class="highlight-gray"> = # servers, m = # keys)</mark></li></ul><p id="15e2e7d3-01e5-80fd-94d1-fb8c30b68e1c" class="">⇒ When nodes connect/disconnect, <strong>only O(K/N) keys need remapping</strong></p></div></figure><hr id="15e2e7d3-01e5-803a-98a2-f1dc35d13523"/><p id="15e2e7d3-01e5-80dc-b6d1-edd715add02d" class=""><strong>Motivation </strong></p><p id="15e2e7d3-01e5-801d-ae6e-df6fb8aa410f" class="">How do we find these servers? </p><ul id="15e2e7d3-01e5-80e2-87d1-cd4835d34778" class="bulleted-list"><li style="list-style-type:disc">We don’t want a centralized machine to keep track of it all <ul id="15e2e7d3-01e5-8084-aa6a-e0cf87e0a399" class="bulleted-list"><li style="list-style-type:circle">⇒ not true peer to peer.</li></ul></li></ul><ul id="15e2e7d3-01e5-80b1-b1c9-cd0ffb90ee4c" class="bulleted-list"><li style="list-style-type:disc">Want: every machine responsible for their own keys... but then this is costly (as explained before), since each has a registry and need to ensure consistency.</li></ul><ul id="15e2e7d3-01e5-80c2-a58a-e2ddef265a68" class="bulleted-list"><li style="list-style-type:disc">Want <strong>scalable</strong>: when new node joins/leaves, it sends no more then <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>l</mi><mi>y</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">poly(log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span> messages.<br/>• e.g. <br/><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>l</mi><mi>o</mi><msup><mi>g</mi><mn>2</mn></msup><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> log(n), log^2(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span><span>﻿</span></span>, … </li></ul><h3 id="15e2e7d3-01e5-805a-a914-fb79e6302783" class="">Chord Protocol </h3><figure id="15e2e7d3-01e5-809e-85b5-df0fea48bb4d" class="image"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_12.49.55.png"><img style="width:192px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_12.49.55.png"/></a></figure><hr id="15e2e7d3-01e5-80f9-9706-e58285afadb7"/><h1 id="15e2e7d3-01e5-80fc-99dc-c9e943058572" class="">CAP, PAC</h1><p id="15e2e7d3-01e5-8010-9f56-e90fdd4d2a3a" class=""><em><mark class="highlight-gray">How does HBase (distributed, keys-as-strings database) provide consistency compared to a traditional database? </mark></em></p><p id="15e2e7d3-01e5-80db-97f9-e2fde35ca48d" class="">With consistency, we want: users to always have the most recent value, not an outdated one. </p><p id="15e2e7d3-01e5-80ce-b460-ce0b033a9275" class=""><strong>Consistency: </strong>all Nodes Return the Same Value<div class="indented"><p id="15e2e7d3-01e5-8091-9e41-ff8c84007ec9" class="">e.g. after depositing money, your updated balance is consistent across every bank data center in the country. </p><figure id="15e2e7d3-01e5-8067-b30f-ce7c9c2597fb" class="image" style="text-align:center"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.01.57.png"><img style="width:384px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.01.57.png"/></a></figure></div></p><p id="15e2e7d3-01e5-80eb-9d38-e56f42cdf2d0" class=""><strong>Availability: </strong>Node failures do not prevent operation</p><ul id="15e2e7d3-01e5-8042-867f-ede8ca38af60" class="bulleted-list"><li style="list-style-type:disc">i.e. Cant talk to server thats down, but can talk to a server that’s available (even if others are offline). <figure id="15e2e7d3-01e5-8067-931a-c95a4afb7524" class="image" style="text-align:center"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.01.36.png"><img style="width:336px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.01.36.png"/></a></figure></li></ul><p id="15e2e7d3-01e5-80e2-b23b-f3368accd311" class=""><strong>Partition Tolerance: </strong>System operates despite network partition</p><ul id="15e2e7d3-01e5-80ea-a74b-ef8ed8bfbbff" class="bulleted-list"><li style="list-style-type:disc">e.g. Even if the link goes down, the network still operates in two partitions, and customers in Vancouver and Toronto are both unaffected (other than not being able to connect to each other, if that’s relevant)</li></ul><figure id="15e2e7d3-01e5-80c2-a812-d3fd6e6c3c69" class="image"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_12.59.16.png"><img style="width:336px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_12.59.16.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="15e2e7d3-01e5-8073-9148-fe716e5c1efd"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/exclamation-mark_gray.svg"/></div><div style="width:100%"><p id="ccf3145f-7d8c-4299-a8dc-988113a421f4" class=""><strong>CAP Theorem</strong></p><p id="15e2e7d3-01e5-80a0-845c-d52dc9e0f754" class="">Choice of what to do do in the case of partioning.</p><p id="15e2e7d3-01e5-80ea-8be0-f2676c5db282" class=""><em>“when faced with a network partition, do you stay </em><em><strong>A</strong></em><em>vailable, or stay </em><em><strong>C</strong></em><em>onsistent?”</em></p><figure id="15e2e7d3-01e5-809b-8e70-cf3a798fd9db" class="image" style="text-align:center"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.02.49.png"><img style="width:288px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.02.49.png"/></a></figure><p id="15e2e7d3-01e5-8082-ad30-c563b54265bc" class="">2 Kinds of distributed systems: <div class="indented"><ul id="15e2e7d3-01e5-8012-886e-ee94fc4d6468" class="bulleted-list"><li style="list-style-type:disc"><strong>C+P</strong>: BigTable, HBase</li></ul><ul id="15e2e7d3-01e5-8097-8c00-d5cb8259ac9f" class="bulleted-list"><li style="list-style-type:disc"><strong>A+P: </strong>DNS</li></ul><ul id="15e2e7d3-01e5-8060-b901-ca10380f2cd5" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-red_background"><strong>A+C: </strong></mark><mark class="highlight-red_background">impossible (in distributed systems)</mark></li></ul></div></p><p id="15e2e7d3-01e5-80b4-bf82-c4c8f2cbb728" class="">Easy to be A+C if partitions can’t happen!  But if they do, you can’t be both.</p></div></figure><figure id="15e2e7d3-01e5-801f-9359-ee06d5e2b474" class="image"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.07.43.png"><img style="width:384px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.07.43.png"/></a></figure><h3 id="15e2e7d3-01e5-8001-8f23-d6def41cbe5a" class="">Types of Consistency</h3><table id="15e2e7d3-01e5-8028-8949-efd0b5e3ec40" class="simple-table"><thead class="simple-table-header"><tr id="15e2e7d3-01e5-80f2-8072-dee69a054ad3"><th id="EFOg" class="simple-table-header-color simple-table-header"></th><th id="\:tZ" class="simple-table-header-color simple-table-header" style="width:352.6672668457031px">After an update operation</th></tr></thead><tbody><tr id="7cbed9be-a367-4524-b3cb-cfd914ad1dfd"><th id="EFOg" class="simple-table-header-color simple-table-header"><strong>Strong</strong></th><td id="\:tZ" class="" style="width:352.6672668457031px"><strong>all</strong> subsequent access will return the same value </td></tr><tr id="db363326-1c14-4a3a-b2d4-fe40f218b50f"><th id="EFOg" class="simple-table-header-color simple-table-header"><strong>Weak</strong></th><td id="\:tZ" class="" style="width:352.6672668457031px"><strong>some</strong> access will return the new value, and others<br/>the old value <br/></td></tr><tr id="6defcffb-52e2-4f07-84c1-aa239db6b57e"><th id="EFOg" class="simple-table-header-color simple-table-header"><strong>Eventual</strong></th><td id="\:tZ" class="" style="width:352.6672668457031px">After an update at time <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>, <strong>all</strong> access <strong>after</strong> <strong>some</strong> <strong>time</strong> <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> &gt; <link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> will return the same value<br/><br/><em><mark class="highlight-gray"><mark class="highlight-default_background">*(If no further updates between </mark></mark></em><em><mark class="highlight-gray"><mark class="highlight-default_background"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></mark></mark></em><em><mark class="highlight-gray"><mark class="highlight-default_background">-</mark></mark></em><em><mark class="highlight-gray"><mark class="highlight-default_background"><link rel="stylesheet" type="text/css" href="../../notion_styles.css"/><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></mark></mark></em><em><mark class="highlight-gray"><mark class="highlight-default_background">)</mark></mark></em></td></tr></tbody></table><p id="15e2e7d3-01e5-8065-abcd-f65dfb7659b0" class="">e.g.  Facebook is Eventually Consistent</p><ul id="15e2e7d3-01e5-8057-a7e5-dbc642c86c69" class="bulleted-list"><li style="list-style-type:disc">It’s a huge distributed network of datacenters</li></ul><ul id="15e2e7d3-01e5-8036-bb50-d0142f3c7459" class="bulleted-list"><li style="list-style-type:disc">Unworkable to have strong consistency AND low latency (even w’out partitions)</li></ul><ul id="15e2e7d3-01e5-802f-91f3-f3566777f792" class="bulleted-list"><li style="list-style-type:disc"><strong>Tradeoff consistency </strong>for<strong> availability</strong>: If it took 1-2 minutes for a post to stop spinning, people would give up. </li></ul><p id="15e2e7d3-01e5-80d8-a171-e048d1af2802" class="">
</p><h3 id="15e2e7d3-01e5-8008-b230-d09bbef4779b" class=""><strong>Tradeoff between Consistency and Latency </strong></h3><p id="15e2e7d3-01e5-8084-a651-c2fc6f5dd39f" class=""><em><mark class="highlight-gray"><strong>In the case of NO PARTITIONS </strong></mark></em></p><p id="15e2e7d3-01e5-80e4-a85a-e0ce448a1cc3" class="">Caused by the possibility of failure in distributed systems</p><ul id="15e2e7d3-01e5-8062-a6c1-da2e0e2f6d06" class="bulleted-list"><li style="list-style-type:disc">High availability ⇒ replicate data ⇒ consistency problem</li></ul><p id="15e2e7d3-01e5-8012-94bf-f8445f3579c1" class="">Unavailable ⇒ high latency</p><p id="15e2e7d3-01e5-80ea-b019-fbf8031cee34" class="">Achieving <strong>different levels of consistency/availability</strong> takes <strong>different amount of time</strong></p><p id="15e2e7d3-01e5-807f-b7c3-dd689b901176" class="">
</p><h3 id="15e2e7d3-01e5-80f8-9532-da3d8f76506c" class="">PACELC</h3><p id="15e2e7d3-01e5-806b-a727-de38bc2883ff" class=""><em><mark class="highlight-gray"><strong>More complete description of the space of potential tradeoffs for distributed system:</strong></mark></em></p><figure id="15e2e7d3-01e5-806d-9880-e43785209139" class="image"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.24.03.png"><img style="width:432px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.24.03.png"/></a></figure><p id="15e2e7d3-01e5-80c2-9544-d7554958f12e" class="">
</p><p id="15e2e7d3-01e5-80e3-9b1e-e2dcf46fe11c" class=""><strong>Examples: </strong></p><ul id="15e2e7d3-01e5-80e5-8add-f9cc843b1d38" class="bulleted-list"><li style="list-style-type:disc">PA/EL Systems: Give up both Cs for availability and lower latency<ul id="15e2e7d3-01e5-8092-ae9b-d1489419101c" class="bulleted-list"><li style="list-style-type:circle">Dynamo, Cassandra, Riak </li></ul></li></ul><ul id="15e2e7d3-01e5-8024-bd94-fbf3b2650499" class="bulleted-list"><li style="list-style-type:disc">PC/EC Systems: Refuse to give up consistency and pay the cost of availability and latency<ul id="15e2e7d3-01e5-8025-ae15-fc013e0c5071" class="bulleted-list"><li style="list-style-type:circle">BigTable, Hbase, VoltDB/H-Store, any ACID DB</li></ul></li></ul><ul id="15e2e7d3-01e5-80bb-ad0a-fb569b9c21f6" class="bulleted-list"><li style="list-style-type:disc">PA/EC Systems: Give up consistency when a partition happens and keep consistency in normal operations<ul id="15e2e7d3-01e5-80a4-b9a2-cea043e426e2" class="bulleted-list"><li style="list-style-type:circle">MongoDB </li></ul></li></ul><ul id="15e2e7d3-01e5-808f-87f3-fe1bdf3c7d20" class="bulleted-list"><li style="list-style-type:disc">PC/EL System: Keep consistency if a partition occurs but gives up consistency for latency in normal operations<ul id="15e2e7d3-01e5-80ab-a3ca-c20c6cf9b9c4" class="bulleted-list"><li style="list-style-type:circle">Azure Cosmos</li></ul></li></ul><h3 id="15e2e7d3-01e5-8076-95c8-c3cb309a0030" class="">What does HBase do? </h3><p id="15e2e7d3-01e5-8034-9764-cf6df4348950" class="">HBase is PC/EC</p><ul id="15e2e7d3-01e5-80c1-aa04-f44da1b6c183" class="bulleted-list"><li style="list-style-type:disc">But does not have high latency: <ul id="15e2e7d3-01e5-80fe-9fce-ef8925c3d69a" class="bulleted-list"><li style="list-style-type:circle">Transactions are only allowed to update a single row <ul id="15e2e7d3-01e5-8095-bef8-e2191bd9bccd" class="bulleted-list"><li style="list-style-type:square">With an appropriate row key that’s often not much of a limit </li></ul><ul id="15e2e7d3-01e5-80c4-8316-e602421b9383" class="bulleted-list"><li style="list-style-type:square">Only ONE Region Server oversees a given Region</li></ul><ul id="15e2e7d3-01e5-8020-8e1a-c892158266aa" class="bulleted-list"><li style="list-style-type:square">You can think of each row being its own database!</li></ul></li></ul></li></ul><figure id="15e2e7d3-01e5-802a-9260-fb4cb86cee28" class="image"><a href="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.24.43.png"><img style="width:480px" src="9%20%E2%80%94%20Mutable%20State/Screenshot_2024-12-16_at_13.24.43.png"/></a></figure><p id="15e2e7d3-01e5-8026-beb6-cc318a3f1111" class="">
</p><p id="15e2e7d3-01e5-809e-9f66-e69f0612de42" class="">
</p><p id="15e2e7d3-01e5-80cd-bf03-d2710ae8fc7a" class="">
</p><p id="15e2e7d3-01e5-8075-b0ff-d8f3f75945b4" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>